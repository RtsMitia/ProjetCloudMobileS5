!function(){function e(e,t,a){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var n=a.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}System.register(["./index-legacy-DO9rcyb7.js","./_plugin-vue_export-helper-legacy-BeRy98uk.js"],function(t,a){"use strict";var n,o,i,l,r,s,c,d,u,m,g,p,f,h,v,b,w,x,y,k,S,_,L,M,A,E,z,C,T,I,j,B,F,O,U,P,$,H,N,V,D,R,q,G,K,Y,J;return{setters:[e=>{n=e.x,o=e.y,i=e.T,l=e.z,r=e.A,s=e.B,c=e.C,d=e.D,u=e.E,m=e.F,g=e.G,p=e.H,f=e.r,h=e.p,v=e.d,b=e.c,w=e.o,x=e.b,y=e.I,k=e.w,S=e.a,_=e.J,L=e.K,M=e.n,A=e.L,E=e.f,z=e.g,C=e.e,T=e.k,I=e.i,j=e.j,B=e.M,F=e.N,O=e.O,U=e.P,P=e.q,$=e.t,H=e.Q,N=e.R,V=e.S,D=e.U,R=e.V,q=e.h,G=e.v},e=>{K=e.u,Y=e._,J=e.a}],execute:function(){var a=document.createElement("style");a.textContent=".modern-header[data-v-fbd618ef]{box-shadow:0 2px 8px rgba(0,0,0,.08)}.modern-toolbar[data-v-fbd618ef]{--background: white;--border-color: transparent;--min-height: 56px}.modern-title[data-v-fbd618ef]{font-weight:600;color:#1a1a1a;font-size:1.1rem}.modern-icon-button[data-v-fbd618ef]{--color: #1a1a1a;--color-activated: #000;--padding-start: 8px;--padding-end: 8px}.modern-icon-button ion-icon[data-v-fbd618ef]{font-size:1.4rem}.filters-toolbar[data-v-131a57c1]{--background: #f8f9fa;--border-color: #e5e7eb;border-bottom:1px solid #e5e7eb}.filters-container[data-v-131a57c1]{padding:16px;background:#fff;margin:8px;border-radius:12px;box-shadow:0 1px 3px rgba(0,0,0,.06)}.filter-section[data-v-131a57c1]{margin-bottom:16px}.filter-section[data-v-131a57c1]:last-child{margin-bottom:0}.filter-label[data-v-131a57c1]{display:block;font-size:.85rem;font-weight:600;color:#1a1a1a;margin-bottom:10px;text-transform:uppercase;letter-spacing:.5px}.modern-segment[data-v-131a57c1]{--background: #f5f5f5;border-radius:8px;padding:4px}.modern-segment-button[data-v-131a57c1]{--color: #666;--color-checked: #1a1a1a;--background-checked: white;--indicator-height: 0;min-height:36px;border-radius:6px;font-size:.9rem;font-weight:500;transition:all .2s ease}.modern-segment-button[data-v-131a57c1]::part(native){transition:all .2s ease}.modern-segment-button.segment-button-checked[data-v-131a57c1]{box-shadow:0 1px 3px rgba(0,0,0,.1)}.checkbox-container[data-v-131a57c1]{display:flex;align-items:center;padding:12px;background:#f8f9fa;border-radius:8px;cursor:pointer;transition:background .2s ease}.checkbox-container[data-v-131a57c1]:hover{background:#f0f1f3}.modern-checkbox[data-v-131a57c1]{--size: 20px;--checkbox-background-checked: #1a1a1a;--border-color-checked: #1a1a1a;--checkmark-color: white;margin:0}.checkbox-label[data-v-131a57c1]{margin-left:12px;font-size:.95rem;color:#1a1a1a;font-weight:500;flex:1}.map-loader[data-v-9e9dd113]{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);text-align:center;z-index:1000}.map-loader p[data-v-9e9dd113]{margin-top:1rem;color:var(--ion-color-medium)}.map-legend[data-v-aa000f00]{position:fixed;bottom:80px;right:16px;background:#fff;border-radius:12px;box-shadow:0 4px 12px rgba(0,0,0,.15);padding:12px;min-width:180px;z-index:1000;animation:slideIn-aa000f00 .3s ease-out}@keyframes slideIn-aa000f00{0%{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}.legend-header[data-v-aa000f00]{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;padding-bottom:8px;border-bottom:2px solid #f0f0f0}.legend-title[data-v-aa000f00]{font-weight:600;font-size:.95rem;color:#1a1a1a}.legend-close[data-v-aa000f00]{background:none;border:none;font-size:1.5rem;color:#666;cursor:pointer;padding:0;width:24px;height:24px;display:flex;align-items:center;justify-content:center;border-radius:4px;transition:background .2s}.legend-close[data-v-aa000f00]:hover{background:#f5f5f5}.legend-items[data-v-aa000f00]{display:flex;flex-direction:column;gap:10px}.legend-item[data-v-aa000f00]{display:flex;align-items:center;gap:10px}.legend-icon[data-v-aa000f00]{width:32px;height:32px;border-radius:50%;border:2.5px solid;background:#fff;display:flex;align-items:center;justify-content:center;font-size:16px;font-weight:700;flex-shrink:0}.legend-text[data-v-aa000f00]{font-size:.9rem;color:#4b5563;font-weight:500}.user-location-button[data-v-79cf7e23]{position:absolute;bottom:120px;right:16px;z-index:1000}.location-btn[data-v-79cf7e23]{--box-shadow: 0 4px 6px rgba(0, 0, 0, .1);width:48px;height:48px}.location-btn ion-icon[data-v-79cf7e23]{font-size:24px}.map-container[data-v-d7a9ba49]{height:100%;width:100%}[data-v-d7a9ba49] .leaflet-pane,[data-v-d7a9ba49] .leaflet-top,[data-v-d7a9ba49] .leaflet-bottom{z-index:400}[data-v-d7a9ba49] .leaflet-tile-container{will-change:transform}[data-v-d7a9ba49] .leaflet-tile{image-rendering:-webkit-optimize-contrast;image-rendering:crisp-edges}[data-v-d7a9ba49] .custom-marker{background:transparent;border:none}[data-v-d7a9ba49] .leaflet-popup-content{margin:10px}[data-v-d7a9ba49] .leaflet-popup-content-wrapper{border-radius:8px}\n/*$vite$:1*/",document.head.appendChild(a);const Q=new class{constructor(){e(this,"collectionName","signalementListe")}async createSignalement(e){try{const t=n.currentUser;if(!t)throw new Error("Utilisateur non connectÃ©");const a={id:null,userId:e.userId,userEmail:t.email||"",x:e.x,y:e.y,localisation:e.localisation||"",description:e.description||"",statusLibelle:e.statusLibelle||"En attente",createdAt:"string"==typeof e.createdAt?e.createdAt:i.fromDate(e.createdAt),updatedAt:o(),photoUrls:[],priority:3},c=await l(r(s,this.collectionName),a);return console.log("Signalement crÃ©Ã© avec ID:",c.id),c.id}catch(t){throw console.error("Erreur lors de la crÃ©ation du signalement:",t),t}}async getUserSignalements(){try{const e=n.currentUser;if(!e)throw new Error("Utilisateur non connectÃ©");const t=c(r(s,this.collectionName),d("userId","==",e.uid),u("createdAt","desc")),a=await m(t),o=[];return a.forEach(e=>{o.push({id:e.id,...e.data()})}),o}catch(e){throw console.error("Erreur lors de la rÃ©cupÃ©ration des signalements:",e),e}}async getAllSignalements(){try{const e=c(r(s,this.collectionName),u("createdAt","desc")),t=await m(e),a=[];return t.forEach(e=>{a.push({id:e.id,...e.data()})}),a}catch(e){throw console.error("Erreur lors de la rÃ©cupÃ©ration des signalements:",e),e}}subscribeToSignalements(e){const t=c(r(s,this.collectionName),u("createdAt","desc"));return g(t,t=>{const a=[];t.forEach(e=>{a.push({id:e.id,...e.data()})}),console.log(`${a.length} signalements reÃ§us de Firestore`),e(a)},e=>{console.error("Erreur lors de l'Ã©coute des signalements:",e)})}};const W=v({__name:"MapHeader",props:{isAuthenticated:{type:Boolean}},emits:["toggleFilters","logout","goToLogin"],setup:e=>(t,a)=>(w(),b(x(y),{class:"modern-header"},{default:k(()=>[S(x(C),{class:"modern-toolbar"},{default:k(()=>[S(x(L),{slot:"start"},{default:k(()=>[S(x(M),{onClick:a[0]||(a[0]=e=>t.$emit("toggleFilters")),class:"modern-icon-button"},{default:k(()=>[S(x(A),{icon:x("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' class='ionicon' viewBox='0 0 512 512'><path stroke-linecap='round' stroke-linejoin='round' d='M32 144h448M112 256h288M208 368h96' class='ionicon-fill-none ionicon-stroke-width'/></svg>")},null,8,["icon"])]),_:1})]),_:1}),S(x(E),{class:"modern-title"},{default:k(()=>[...a[3]||(a[3]=[z("Carte des Signalements",-1)])]),_:1}),S(x(L),{slot:"end"},{default:k(()=>[e.isAuthenticated?(w(),b(x(M),{key:0,onClick:a[1]||(a[1]=e=>t.$emit("logout")),class:"modern-icon-button"},{default:k(()=>[S(x(A),{icon:x("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' class='ionicon' viewBox='0 0 512 512'><path d='M304 336v40a40 40 0 01-40 40H104a40 40 0 01-40-40V136a40 40 0 0140-40h152c22.09 0 48 17.91 48 40v40M368 336l80-80-80-80M176 256h256' stroke-linecap='round' stroke-linejoin='round' class='ionicon-fill-none ionicon-stroke-width'/></svg>")},null,8,["icon"])]),_:1})):(w(),b(x(M),{key:1,onClick:a[2]||(a[2]=e=>t.$emit("goToLogin")),class:"modern-icon-button"},{default:k(()=>[S(x(A),{icon:x("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' class='ionicon' viewBox='0 0 512 512'><path d='M192 176v-40a40 40 0 0140-40h160a40 40 0 0140 40v240a40 40 0 01-40 40H240c-22.09 0-48-17.91-48-40v-40' stroke-linecap='round' stroke-linejoin='round' class='ionicon-fill-none ionicon-stroke-width'/><path stroke-linecap='round' stroke-linejoin='round' d='M288 336l80-80-80-80M80 256h272' class='ionicon-fill-none ionicon-stroke-width'/></svg>")},null,8,["icon"])]),_:1}))]),_:1})]),_:1}),_(t.$slots,"filters",{},void 0,!0)]),_:3}))}),X=Y(W,[["__scopeId","data-v-fbd618ef"]]),Z={class:"filters-container"},ee={class:"filter-section"},te={key:0,class:"filter-section"},ae={class:"checkbox-container"},ne=v({__name:"MapFilters",props:{show:{type:Boolean},modelStatus:{},modelOnlyMine:{type:Boolean},isAuthenticated:{type:Boolean}},emits:["update:modelStatus","update:modelOnlyMine","filtersChanged"],setup(e,{emit:t}){const a=t;function n(e){a("update:modelStatus",e.detail.value),a("filtersChanged")}function o(e){a("update:modelOnlyMine",e.detail.checked),a("filtersChanged")}return(t,a)=>e.show?(w(),b(x(C),{key:0,class:"filters-toolbar"},{default:k(()=>[I("div",Z,[I("div",ee,[a[4]||(a[4]=I("label",{class:"filter-label"},"Statut",-1)),S(x(O),{value:e.modelStatus,onIonChange:n,class:"modern-segment"},{default:k(()=>[S(x(B),{value:"all",class:"modern-segment-button"},{default:k(()=>[S(x(F),null,{default:k(()=>[...a[0]||(a[0]=[z("Tous",-1)])]),_:1})]),_:1}),S(x(B),{value:"En attente",class:"modern-segment-button"},{default:k(()=>[S(x(F),null,{default:k(()=>[...a[1]||(a[1]=[z("En attente",-1)])]),_:1})]),_:1}),S(x(B),{value:"En cours",class:"modern-segment-button"},{default:k(()=>[S(x(F),null,{default:k(()=>[...a[2]||(a[2]=[z("En cours",-1)])]),_:1})]),_:1}),S(x(B),{value:"RÃ©solu",class:"modern-segment-button"},{default:k(()=>[S(x(F),null,{default:k(()=>[...a[3]||(a[3]=[z("RÃ©solu",-1)])]),_:1})]),_:1})]),_:1},8,["value"])]),e.isAuthenticated?(w(),j("div",te,[I("label",ae,[S(x(U),{checked:e.modelOnlyMine,onIonChange:o,class:"modern-checkbox"},null,8,["checked"]),a[5]||(a[5]=I("span",{class:"checkbox-label"},"Mes signalements uniquement",-1))])])):T("",!0)])]),_:1})):T("",!0)}}),oe=Y(ne,[["__scopeId","data-v-131a57c1"]]),ie={key:0,class:"map-loader"},le=v({__name:"MapLoader",props:{isLoading:{type:Boolean},message:{}},setup:e=>(t,a)=>e.isLoading?(w(),j("div",ie,[S(x(P),{name:"crescent"}),I("p",null,$(e.message),1)])):T("",!0)}),re=Y(le,[["__scopeId","data-v-9e9dd113"]]),se=v({__name:"AddSignalementButton",props:{show:{type:Boolean}},emits:["click"],setup:e=>(t,a)=>e.show?(w(),b(x(H),{key:0,vertical:"bottom",horizontal:"end",slot:"fixed"},{default:k(()=>[S(x(N),{onClick:a[0]||(a[0]=e=>t.$emit("click"))},{default:k(()=>[S(x(A),{icon:x("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' class='ionicon' viewBox='0 0 512 512'><path stroke-linecap='round' stroke-linejoin='round' d='M256 112v288M400 256H112' class='ionicon-fill-none ionicon-stroke-width'/></svg>")},null,8,["icon"])]),_:1})]),_:1})):T("",!0)}),ce={class:"user-location-button"},de=v({__name:"UserLocationButton",props:{isTrackingLocation:{type:Boolean}},emits:["toggle-tracking"],setup(e,{emit:t}){const a=t;function n(){a("toggle-tracking")}return(t,a)=>(w(),j("div",ce,[S(x(M),{color:e.isTrackingLocation?"primary":"medium",fill:"solid",shape:"round",size:"default",onClick:n,class:"location-btn"},{default:k(()=>[S(x(A),{icon:e.isTrackingLocation?x("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' class='ionicon' viewBox='0 0 512 512'><path d='M258.9 48C141.92 46.42 46.42 141.92 48 258.9c1.56 112.19 92.91 203.54 205.1 205.1 117 1.6 212.48-93.9 210.88-210.88C462.44 140.91 371.09 49.56 258.9 48zM351 175.24l-82.24 186.52c-4.79 10.47-20.78 7-20.78-4.56V268a4 4 0 00-4-4H154.8c-11.52 0-15-15.87-4.57-20.67L336.76 161A10.73 10.73 0 01351 175.24z'/></svg>"):x("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' class='ionicon' viewBox='0 0 512 512'><path d='M336.76 161l-186.53 82.35c-10.47 4.8-6.95 20.67 4.57 20.67H244a4 4 0 014 4v89.18c0 11.52 16 15 20.78 4.56L351 175.24A10.73 10.73 0 00336.76 161z'/><path d='M448 256c0-106-86-192-192-192S64 150 64 256s86 192 192 192 192-86 192-192z' stroke-miterlimit='10' class='ionicon-fill-none ionicon-stroke-width'/></svg>"),slot:"icon-only"},null,8,["icon"])]),_:1},8,["color"])]))}}),ue=Y(de,[["__scopeId","data-v-79cf7e23"]]),me={async showAlert(e,t){const a=await V.create({header:e,message:t,buttons:["OK"]});await a.present()},async showSuccess(e){await this.showAlert("SuccÃ¨s !",e)},async showError(e){await this.showAlert("Erreur",e)},showConfirm:async(e,t,a="Confirmer",n="Annuler")=>new Promise(async o=>{const i=await V.create({header:e,message:t,buttons:[{text:n,role:"cancel",handler:()=>o(!1)},{text:a,handler:()=>o(!0)}]});await i.present()}),showSignalementForm:async()=>new Promise(async e=>{const t=await V.create({header:"DÃ©crire le problÃ¨me",inputs:[{name:"description",type:"textarea",placeholder:"DÃ©crivez le problÃ¨me routier (nid-de-poule, route dÃ©gradÃ©e, etc.)"},{name:"localisation",type:"text",placeholder:"Adresse ou nom du lieu (optionnel)"}],buttons:[{text:"Annuler",role:"cancel",handler:()=>e(null)},{text:"Envoyer",handler:t=>e(t)}]});await t.present()}),async showSignalementModeInfo(){await this.showAlert("Mode signalement activÃ©","Cliquez sur la carte pour placer un marqueur Ã  l'emplacement du problÃ¨me.")},showLocationChoice:async()=>new Promise(async e=>{const t=await V.create({header:"ðŸ“ Localisation du signalement",message:"OÃ¹ se trouve le problÃ¨me ?",buttons:[{text:"Annuler",role:"cancel",handler:()=>e(null)},{text:"Ã€ ma position",cssClass:"primary-button",handler:()=>e("current")},{text:"Choisir sur la carte",handler:()=>e("map")}]});await t.present()})};t("default",Y(v({__name:"MapPage",setup(e){const{isAuthenticated:t,logout:a,goToLogin:n}=K(),{filteredSignalements:o,selectedStatus:i,showOnlyMySignalements:l,subscribeToSignalements:r,unsubscribeFromSignalements:s,applyFilters:c,createSignalement:d}=function(){const{currentUser:e}=K(),t=f([]),a=f([]),n=f(!1),o=f(""),i=f("all"),l=f(!1);let r=null;function s(){r&&(r(),r=null)}function c(){var n;let o=[...t.value];"all"!==i.value&&(o=o.filter(e=>e.statusLibelle===i.value)),l.value&&null!==(n=e.value)&&void 0!==n&&n.uid&&(o=o.filter(t=>{var a;return t.userId===(null===(a=e.value)||void 0===a?void 0:a.uid)})),a.value=o}const d=h(()=>({total:t.value.length,filtered:a.value.length,byStatus:{enAttente:t.value.filter(e=>"En attente"===e.statusLibelle).length,valide:t.value.filter(e=>"ValidÃ©"===e.statusLibelle).length,enCours:t.value.filter(e=>"En cours"===e.statusLibelle).length,resolu:t.value.filter(e=>"RÃ©solu"===e.statusLibelle).length,rejete:t.value.filter(e=>"RejetÃ©"===e.statusLibelle).length}}));return p(()=>{s()}),{signalements:t,filteredSignalements:a,isLoading:n,error:o,stats:d,selectedStatus:i,showOnlyMySignalements:l,subscribeToSignalements:function(){r=Q.subscribeToSignalements(e=>{t.value=e,c()})},unsubscribeFromSignalements:s,applyFilters:c,createSignalement:async function(t,a,i,l){if(!e.value)throw new Error("Utilisateur non connectÃ©");n.value=!0,o.value="";try{const n={id:null,userId:e.value.uid,x:a,y:t,localisation:l,description:i,statusLibelle:"En attente",createdAt:(new Date).toISOString()},o=await Q.createSignalement(n);return console.log("âœ… Signalement crÃ©Ã©:",o),o}catch(r){throw o.value="Impossible de crÃ©er le signalement",console.error("âŒ Erreur:",r),r}finally{n.value=!1}},fetchUserSignalements:async function(){n.value=!0;try{return await Q.getUserSignalements()}catch(e){throw o.value="Impossible de rÃ©cupÃ©rer vos signalements",e}finally{n.value=!1}}}}(),{isMapReady:u,isTrackingLocation:m,userLocation:g,initMap:v,destroyMap:y,displaySignalements:_,addTempMarker:L,removeTempMarker:M,startTrackingLocation:A,stopTrackingLocation:E}=J(),z=f(!1),C=f(!1);function T(){c()}function j(){m.value?E():A(!0)}async function B(){await a()}async function F(){const e=await me.showLocationChoice();e&&("current"===e?await async function(){if(!g.value)return void(await me.showError("Position non disponible. Veuillez activer la gÃ©olocalisation."));const{lat:e,lng:t}=g.value;L(e,t);const a=await me.showSignalementForm();if(a)try{await d(e,t,a.description,a.localisation||""),await me.showSuccess("Signalement crÃ©Ã© avec succÃ¨s !")}catch(n){await me.showError("Impossible de crÃ©er le signalement. VÃ©rifiez votre connexion.")}M()}():(C.value=!0,await me.showSignalementModeInfo()))}async function O(e,t){if(!C.value)return;L(e,t);const a=await me.showSignalementForm();if(a)try{await d(e,t,a.description,a.localisation||""),await me.showSuccess("Signalement crÃ©Ã© avec succÃ¨s !")}catch(n){await me.showError("Impossible de crÃ©er le signalement. VÃ©rifiez votre connexion.")}M(),C.value=!1}return D(()=>{setTimeout(()=>{v(O),r()},100)}),p(()=>{s(),y()}),R(o,e=>{_(e)}),(e,a)=>(w(),b(x(G),null,{default:k(()=>[S(x(X),{isAuthenticated:x(t),onToggleFilters:a[2]||(a[2]=e=>z.value=!z.value),onLogout:B,onGoToLogin:x(n)},{filters:k(()=>[S(x(oe),{show:z.value,modelStatus:x(i),modelOnlyMine:x(l),isAuthenticated:x(t),"onUpdate:modelStatus":a[0]||(a[0]=e=>i.value=e),"onUpdate:modelOnlyMine":a[1]||(a[1]=e=>l.value=e),onFiltersChanged:T},null,8,["show","modelStatus","modelOnlyMine","isAuthenticated"])]),_:1},8,["isAuthenticated","onGoToLogin"]),S(x(q),{fullscreen:!0},{default:k(()=>[S(x(re),{isLoading:!x(u),message:"Chargement de la carte..."},null,8,["isLoading"]),a[3]||(a[3]=I("div",{id:"map",class:"map-container"},null,-1)),S(x(ue),{isTrackingLocation:x(m),onToggleTracking:j},null,8,["isTrackingLocation"]),S(x(se),{show:x(t),onClick:F},null,8,["show"])]),_:1})]),_:1}))}}),[["__scopeId","data-v-d7a9ba49"]]))}}})}();
